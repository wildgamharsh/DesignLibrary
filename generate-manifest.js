const fs = require('fs');
const path = require('path');

const DESIGNS_DIR = 'designs';
const OUTPUT_FILE = 'designs-manifest.js';
const ROOT_THUMBNAIL = 'Thumb.jpg';

function getDirectories(srcPath) {
    return fs.readdirSync(srcPath).filter(file => {
        return fs.statSync(path.join(srcPath, file)).isDirectory();
    });
}

function getHtmlFiles(srcPath) {
    return fs.readdirSync(srcPath).filter(file => {
        return file.endsWith('.html');
    });
}

// Map directory names to friendly display titles
function formatTitle(dirname) {
    return dirname
        .split('_')
        .map(word => word.charAt(0).toUpperCase() + word.slice(1))
        .join(' ');
}

const manifest = {};

try {
    const categories = getDirectories(path.join(__dirname, DESIGNS_DIR));

    categories.forEach(category => {
        const categoryPath = path.join(__dirname, DESIGNS_DIR, category);
        const files = getHtmlFiles(categoryPath);

        if (files.length > 0) {
            manifest[category] = {
                title: formatTitle(category),
                items: files.map(file => {
                    const name = path.basename(file, '.html');
                    return {
                        title: formatTitle(name.replace('design-', 'Design ')), // simple prettify
                        file: file,
                        path: `${DESIGNS_DIR}/${category}/${file}`,
                        // Check if a specific thumbnail exists, else use default
                        thumbnail: ROOT_THUMBNAIL
                    };
                })
            };
        }
    });

    const fileContent = `// Auto-generated by generate-manifest.js\nconst DESIGN_MANIFEST = ${JSON.stringify(manifest, null, 2)};`;

    fs.writeFileSync(path.join(__dirname, OUTPUT_FILE), fileContent);
    console.log(`Successfully generated ${OUTPUT_FILE}`);
    console.log(`Found categories: ${Object.keys(manifest).join(', ')}`);

} catch (err) {
    console.error('Error generating manifest:', err);
    process.exit(1);
}
